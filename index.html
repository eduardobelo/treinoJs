<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        .github, .user{
            position: relative;
            display: table;
            width: 100%;
            height: auto;
            margin-top: 40px;
        }
        ul{
            list-style: none;
            text-decoration: none;
        }
        .github li, .user li{
            display: table;
            width: 100%;
        }
        .github li a, .user li a{
        padding: 10px;
        text-decoration: none;
        color: red;
        }
    </style>
</head>
<body>

    <div id="app">
        <ul></ul>
        <input type="text" placeholder="Digite um curso ...">
        <button type="button">Adicionar</button>
    </div>

    <div class="github">
        <input type="text" placeholder="Usuário GitHub">
        <button type="button">Incluir</button>
        <ul></ul>
    </div>

    <div class="user">
        <input type="text" placeholder="Digite um nome" autofocus>
        <button type="button">Incluir</button>
        <ul></ul>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>
        //CALCULAR TARIFA DE UM TAXI
        const OVERNIGHT_FIRE = 3.9;
        const SUNDAY_FIRE = 3;
        const NORMAL_FIRE = 2;
        const SUNDAY_CODE = 0;
        const OVERNIGHT_START = 22;
        const OVERNIGHT_END = 6;

        const calculateTrip = function (date, distance){
            if (isOvernight(date)){
                return calculateTotal(distance, OVERNIGHT_FIRE);
            }
            if (isSunday(date)){
                return calculateTotal(distance, SUNDAY_FIRE);
            }
            return calculateTotal(distance, NORMAL_FIRE); 
        }
        /*const calculateTrip = function (date, distance){
            if (isOvernight(date)) return calculateTotal(distance, OVERNIGHT_FIRE);
            if (isSunday(date)) return calculateTotal(distance, SUNDAY_FIRE);
            return calculateTotal(distance, NORMAL_FIRE);
        }*/

        const isOvernight = function (date){
            return date.getHours() > OVERNIGHT_START || date.getHours() < OVERNIGHT_END;
        }

        const isSunday = function (date){
            return date.getDay() === SUNDAY_CODE;
        }

        const calculateTotal = function(distance, fare){
            return distance * fare
        }
    
        console.log(calculateTrip(new Date("2018-09-20T23:00:00"), 10) === 39);
        console.log(calculateTrip(new Date("2018-09-20T10:00:00"), 10) === 20);
        console.log(calculateTrip(new Date("2018-09-23T10:00:00"), 10) === 30);
        const ageRange =  function (idade) {

            const IDOSO = idade >= 65;
            const ADULTO = idade >= 18 && idade < 65;
            const ADOLESCENTE = idade >= 14 && idade < 18;
            const PREADOLESCENTE = idade >= 12 && idade < 14;
            const CRIANCA =  idade < 12;

            if (IDOSO) return 'Idoso';
            if (ADULTO) return 'Adulto';
            if (ADOLESCENTE) return 'Adolescente';
            if (PREADOLESCENTE) return 'Pré-adolescente';
            if (CRIANCA) return 'Criança';
           
        }
        var rangeAge = ageRange(10);
       
        // const sexClint = function (sex) {
        //     return (sex === 'M') ? 'Masculino' : 'Feminino';
        // }
        //VERIFICAR O SEXO DE UMA PESSOA
        const sexClint = (sex) => (sex === 'M') ? 'Masculino' : 'Feminino';
        console.log(rangeAge+' e '+sexClint('M'));

        //VERIFICAR SE É UM NÚMERO PRIMO
        const isPrime = (number) => {
            const notPrime = number % 2 === 0;
            if (number === 1) return 'Não é um número primo!';
            if (number === 2) return "É um número primo";
            return (notPrime) ? 'Não é um número primo' : 'É um número primo';
        }
        console.log('01 '+isPrime(1));
        console.log('02 '+isPrime(2));
        console.log('04 '+isPrime(4));
        console.log('07 '+isPrime(7));
        console.log('10 '+isPrime(10));
        console.log('17 '+isPrime(17));
        
        //INSERIR OS VALORES DE UM OBJETO NO CONSOLE
        const objTest = () => {
            var endereco = {
                rua: "Rua dos pinheiros",
                numero: 1293,
                bairro: "Centro",
                cidade: "São Paulo",
                uf: "SP"
            };
            console.log('o usuário mora em '+endereco.cidade+', no bairro '+endereco.bairro+', na rua'+endereco.rua+' com nº '+endereco.numero);
        }
        objTest();

        // LISTA DE NÚMEROS PARES EM UM INTERVALO
        const pairList = (numberInit, numberEnd) => {
            for(var incrementPairList = numberInit; incrementPairList < numberEnd; incrementPairList++ ){
                if((incrementPairList %  2 === 0) && incrementPairList !== 0) console.log(incrementPairList)
            }
        }
        pairList(0, 30);

        //Verificar a existência de skill em um array
        const skills = ["Javascript", "ReactJS", "React Native"];
        const skillHas = (skill) => (skills.indexOf(skill) === 0) ? "O Skill existe no array" : "O Skill não existe no array";
        // const skillHas = (skill) => {
        //     return (skills.indexOf(skill) === 0) ? "O Skill existe no array" : "O Skill não existe no array";
        // }    
        console.log(skillHas('dasdsa'));

        //VETOR DE OBJETOS
        var usuarios = [
            {
                nome: "Diego",
                habilidades: ["Javascript", "ReactJS", "Redux"]
            },
            {
                nome: "Gabriel",
                habilidades: ["VueJS", "Ruby on Rails", "Elixir"]
            }
        ];

        const userSkills = () => {
            console.log("");
            for (var auxUsers = 0; auxUsers < usuarios.length; auxUsers++){
                console.log(usuarios[auxUsers].nome+' possui habilidades em: '+usuarios[auxUsers].habilidades.join(', '));
            }
            console.log("");

            usuarios.map((item, index)=>{
                console.log(item.nome + ' possui conhecimento de ' + item.habilidades.join(', '))             
            })
            console.log("");

            usuarios.forEach((item, index)=>{
                console.log(item.nome + ' possui habilidades em ' + item.habilidades.join(', ')+'.')             
            });
            console.log("");
            for(user of usuarios){
                console.log(user.nome + ' possui habilidades em ' + user.habilidades.join(', ')+'.')             
            };
            console.log("");
        }
       
        userSkills();
        
        // Criar lista de itens via javascript

        //let $ = document.querySelector.bind(document) --> Fazendo ficar parecido com jquery;
        const listElement = document.querySelector('#app ul');
        const inputElement = document.querySelector('#app input');
        const buttonElement = document.querySelector('#app button');

        var listStudy= JSON.parse(localStorage.getItem('List_study')) || [];
        const renderListStudy = () => {
            listElement.innerHTML = '';
            for(list of listStudy){
                var listStudyElement = document.createElement('li');
                var textList = document.createTextNode(list);

                var linkElement = document.createElement('a');
                linkElement.setAttribute('href', '#');
                var pos = listStudy.indexOf(list);
                linkElement.setAttribute('onclick','deleteList('+ pos +')');
                var linkText = document.createTextNode('Excluir');

                linkElement.appendChild(linkText);
                listStudyElement.appendChild(textList);
                listStudyElement.appendChild(linkElement);
                listElement.appendChild(listStudyElement);
            }
        }
        renderListStudy();

        const addItemList = () => {
            var listText = inputElement.value;
            listStudy.push(listText);
            inputElement.value = '';
            renderListStudy();
            saveStorage();
        }
        buttonElement.onclick = addItemList;

        const deleteList = (pos) => {
            listStudy.splice(pos,1);
            renderListStudy();
            saveStorage();
        }

        const saveStorage = () => {
            localStorage.setItem('List_study', JSON.stringify(listStudy));
        }

        // PROMISE
        function checaIdade(idade) {
            // Retornar uma promise
            return new Promise(function(resolve, reject){
                
                setTimeout( () => {
                    return idade >= 18 ? resolve() : reject();
                    /*if (idade >= 18){
                        resolve();
                    }else{
                        reject();
                    }*/
                },2000);
                
            });
        }
        checaIdade(14).then(function() {
            console.log("Maior que 18");
        }).catch(function() {
            console.log("Menor que 18");
        });

        // Ajax 
        
        const listElementAjax = document.querySelector('.github ul');
        const inputElementAjax = document.querySelector('.github input');
        const buttonElementAjax = document.querySelector('.github button');

        
        /*const promiseAjax = (user) => {
            return new Promise (function (resolve, reject){
                var xhr = new XMLHttpRequest();
                xhr.open('GET', ' https://api.github.com/users/'+ user +'/repos');
                xhr.send();
                xhr.onreadystatechange = () => {
                    if(xhr.readyState === 4){
                        if (xhr.status === 200){
                            var dataRepos = JSON.parse(xhr.responseText);
                            if (dataRepos.length != 0){
                                listElementAjax.innerHTML = '';
                                for (nameRepos of dataRepos){
                                    var listRepos = document.createElement('li');
                                    var textListRepos = document.createTextNode(nameRepos.name)
                                    listRepos.appendChild(textListRepos);
                                    resolve(listElementAjax.appendChild(listRepos));
                                }   
                            }else{
                                reject('Usuário invalido!');
                            }
                        }else{
                            reject('Erro na requisição');
                        }    
                    }
                }
            });
        }

        const addItemGit = () => {
            var inputValue = inputElementAjax.value;
            promiseAjax(inputValue).then((response) => {
                
            }).catch((error) => {
                console.log(error)
            });
        }*/

        const renderRepositories = (repositories) => {
            listElementAjax.innerHTML = '';
                for (repos of repositories){
                    var nameRepos = document.createTextNode(repos.name);
                    var liElement = document.createElement('li');
                    
                    liElement.appendChild(nameRepos);
                    listElementAjax.appendChild(liElement);
                } 
        };

        const renderLoading = () => {
            listElementAjax.innerHTML = '';
            var loadingElement = document.createTextNode('Carregando ...');
            var liElement = document.createElement('li');

            liElement.appendChild(loadingElement);
            listElementAjax.appendChild(liElement);
        };

        const renderError = () => {
            listElementAjax.innerHTML = '';
            var errorElement = document.createTextNode('Usuário sem repositório ...');
            var liElement = document.createElement('li');

            liElement.appendChild(errorElement);
            listElementAjax.appendChild(liElement);
        };

        const renderErrorServer = () => {
            listElementAjax.innerHTML = '';
            var errorElement = document.createTextNode('Erro interno do servidor ou usuário não inválido...');
            var liElement = document.createElement('li');

            liElement.appendChild(errorElement);
            listElementAjax.appendChild(liElement);
        };

        const getRepositories = () => {
            var user = inputElementAjax.value;
            
            if (!user) return;

            renderLoading();

            var xhr = new XMLHttpRequest();
                xhr.open('GET', ' https://api.github.com/users/'+ user +'/repos', true);
                xhr.send();
                xhr.onreadystatechange = () => {
                    if(xhr.readyState === 4){
                        if (xhr.status === 200){
                            var dataRepos = JSON.parse(xhr.responseText);
                            if (dataRepos.length != 0) {
                                renderRepositories(dataRepos);
                            }else{
                                renderError();
                            }    
                        }else{
                            renderErrorServer();
                        }    
                    }
                }

        }
        buttonElementAjax.onclick = getRepositories;


        const inputUser = document.querySelector('.user input');
        const buttonUser = document.querySelector('.user button');
        const listaname = JSON.parse(localStorage.getItem('users')) || [];
        const addUser = (name) => {
            listaname.push(name);
            renderUser();
            saveUser(listaname);
            inputUser.value = '';
        }
        
        const saveUser = (listaname) => {
            localStorage.setItem('users', JSON.stringify(listaname));
        }

        const renderUser = () => {
            $('.user ul').empty();
            for (user of listaname){
                var pos = listaname.indexOf(user);
                $('.user ul').append('<li>'+user+'<a href="#" data-pos="'+pos+'" >Excluir usuário</a></li>'); 
            }
        }
        renderUser();

        const removeUser = (pos) => {
            listaname.splice(pos, 1);
            renderUser();
            saveUser(listaname);
            inputUser.value = '';
        }

        const userProcess = (callback) => {
            var name = inputUser.value;
            callback(name);
        }
        $('.user button').on('click', () => {
            userProcess(addUser);
        });
        $('.user ul a').on('click', () => {
            var posRemove = $('.user ul a').attr('data-pos');
            removeUser(posRemove);
        })

    </script>
</body>
</html>